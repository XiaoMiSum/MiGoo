name: 测试用例样本
config:
  variables:
    user2: test
  beforeClass:
    - __hook1(A=beforeClass)
  afterClass:
    - __hook1(A=afterClass)
  request:
    url: http://migoo.xyz/api/login
    method: post
    headers:
      x-host: http://127.0.0.1/
      x-test: ${user2}
cases:
  - title: 验证成功
    request:
      headers:
        token: abc1234567890
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
        - __hook1(A=${user2}${user2})
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      test:
        - ${user}
        - ${pwd2}
      sign: __Digest(string=${user}${pwd})
    validates:
      - {check: status, expect: 200, func: ==}
      - {check: $.status, expect: 200, func: eq}
      - {check: body.data, expect: null, func: isNotEmpty}
  - title: 忽略执行
    config:
      ignore: true
      variables:
        pwd: __generatePassword($user)
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user2}
      password: 12345
    validates:
      - {check: status, expect: 200, func: ==}
      - {check: $.status, expect: 411, func: eq}
      - {check: body.data, expect: null, func: isEmpty}
  - title: 验证失败
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: 12345
      sign: __Digest(string=${user})
    validates:
      - {check: status, expect: 200, func: ==}
      - {check: $.status, expect: 41, func: eq}
      - {check: body.data, expect: null, func: isEmpty}
  - title: case中的after执行exception，用例正常执行
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      sign: __Digest(algorithm=md5,string=${user}${pwd})
    validates:
      - {check: status, expect: 200, func: ==}
      - {check: $.status, expect: 200, func: eq}
      - {check: body.data, expect: null, func: isNotEmpty}
  - title: case中的before执行exception，用例error
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before,B=hshs)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      sign: __Digest(string=${user}${pwd})
    validates:
      - {check: status, expect: 200, func: ==}
      - {check: $.status, expect: 200, func: eq}
      - {check: body.data, expect: null, func: isNotEmpty}
  - title: 自定义断言
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      sign: __Digest(algorithm=md5,string=${user}${pwd})
    validates:
      - {check: xyz.migoo.test.example.TestAssertion, expect: 1}
  - title: 在自定义函数中使用 case 中定义的 变量
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      sign: __Digest(algorithm=md5,string=${user}${pwd})
    validates:
      - {check: xyz.migoo.test.example.TestAssertion, expect: '__TestUseVars(title=${title})'}
  - title: body 多层嵌套使用变量
    config:
      variables:
        pwd1: __generatePassword(password=${pwd})
        pwd2: __generatePassword(password=${pwd1})
      before:
        - __hook1(A=before)
      after:
        - __hook2(A=after,B=before)
    body:
      userName: ${user}
      password: ${pwd2}
      test:
        first:
          key: ${user}
          second:
            value: ${pwd2}
            third:
              - ${user}
              - ${pwd2}
      sign: __Digest(algorithm=md5,string=${user}${pwd})
    validates:
      - {check: status, expect: 200, func: ==}
